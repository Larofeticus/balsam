#!/bin/bash -x
#COBALT -A {{ project }}
#COBALT -n {{ nodes }}
#COBALT -q {{ queue }}
#COBALT -t {{ time_minutes }}
#COBALT --attrs ssds=required:ssd_size=128 

{% if conda_path %}
    source {{ activate_path }} {{ conda_path }}
{% else %}
    export PATH={{ python_path }}:$PATH
{% endif %}

export PATH=$PATH:{{ balsam_bin }}
export PYTHONPATH=$PYTHONPATH:{{ site_top }}:{{ balsam_lib }}

module unload trackdeps
module unload darshan
module unload xalt
export MPICH_GNI_FORK_MODE=FULLCOPY

source balsamactivate {{ balsam_db_path }}
sleep 2

balsam launcher --{{ wf_filter }} --job-mode={{ job_mode }} --time-limit-minutes={{ time_minutes-2 }} --serial-jobs-per-node={{ serial_jobs_per_node }}

source balsamdeactivate
